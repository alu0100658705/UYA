<!doctype html>
<html>

	<head>
      <meta charset="UTF-8">
		  <link rel="stylesheet" href="css/estilos.css">
	    <title>Club de Lectura</title>
	</head>

    <body>
        <form id="formulario" class="formulario" onsubmit="return validate()">
           <div class="libro">
                <label for="titulo"> Título: <abbr class="req" title="required">*</abbr> </label>
                <input type="text" required id="titulo" name="titulo"/>
                <label for="autor"> Autor: <abbr class="req" title="required">*</abbr> </label>
                <input type="text" required id="autor" name="autor"/>
                <label for="fecha"> Fecha: <abbr class="req" title="required">*</abbr> </label>
                <input type="number" required id="fecha" name="fecha"/>
                <label for="genero"> Género: <abbr class="req" title="required">*</abbr> </label>
                <input type="text" required id="genero" name="genero"/>
            </div>
            
            <br>
            <p> Enviar a la base de datos: </br>
            <input type="submit" value="Enviar" name="Enviar" class="button"/> 
            </p>

            <!--
              H91: Utilizamos controles de formulario indicando su nombre y valor.
              H90 (3.3.2): Indicamos si un campo es obligatorio en el LABEL asociado al campo y un asterisco.
              G199: Informar de que el formulario se ha enviado con éxito
              G80: Proporcionamos un botón de tipo "submit" para iniciar un cambio de contexto.
              G13: Avisar de un cambio de contexto.
              SCR18: Validar los campos advirtiendo del error.
            -->
        </form>

        <p> (<abbr class="req" title="required">*</abbr>) Campos requeridos.</p>

    </body>

    <script src="https://www.gstatic.com/firebasejs/5.10.1/firebase.js"></script>
<script>
  
  // Initialize Firebase
    var config = {
        apiKey: "AIzaSyBRwkE7Lj0K_nU11r2wfa9Hy3jfikBUnxQ",
        authDomain: "uya-g2.firebaseapp.com",
        databaseURL: "https://uya-g2.firebaseio.com",
        projectId: "uya-g2",
        storageBucket: "uya-g2.appspot.com",
        messagingSenderId: "98345995388"
    };
    firebase.initializeApp(config);

    var form = document.getElementById('formulario'); 
    var ok = true;

    if(form){ 
      form.addEventListener('submit', formulario); 
    }

    function formulario(event) {
      event.preventDefault(); 
      var titulo = document.getElementById('titulo'); 
      var autor = document.getElementById('autor');
      var fecha = document.getElementById('fecha');
      var genero = document.getElementById('genero');
      var data = {
        'titulo': titulo.value,
        'autor': autor.value,
        'fecha': fecha.value,
        'genero': genero.value,
      }; 
      if (ok == true ) {
      saveformulario(data); 
      form.reset(); 
      }
    }

  function saveformulario(data) {


    firebase.database().ref("libros").push(data)
    .then(function(){
        alert('Enviado con éxito'); 
      }) 
  };

  function validate() {
	var msg = "";

  var pattern = /^[a-zA-ZÀ-ÿ\u00f1\u00d1]+(\s*[a-zA-ZÀ-ÿ\u00f1\u00d1]*)*[a-zA-ZÀ-ÿ\u00f1\u00d1]+$/;
	var aut = document.getElementById("autor");
	if (!pattern.test(aut.value)){ 
    msg += "El campo 'autor' solo puede contener letras y espacios. ";
    ok = false;
  }

  var pattern = /^[a-zA-ZÀ-ÿ\u00f1\u00d1]+(\s*[a-zA-ZÀ-ÿ\u00f1\u00d1]*)*[a-zA-ZÀ-ÿ\u00f1\u00d1]+$/;
	var gen = document.getElementById("genero");
	if (!pattern.test(gen.value)){ 
     msg += "El campo 'género' solo puede contener letras y espacios. ";
     ok = false;
  }

	var pattern = /^[0-9]{4}$/;
	var fech = document.getElementById("fecha");
	if (!pattern.test(fech.value)){  
    msg += "La fecha no es correcta. Debe tener cuatro dígitos. ";
		ok = false;
  }
 
	if (msg != "") {
		alert(msg);
		return false;
	} else return true;
}


</script>
</html>